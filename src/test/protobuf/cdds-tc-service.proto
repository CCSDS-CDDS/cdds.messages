syntax = "proto3";
package ccsds.cdds.tc;
import "types.proto"; 
import "telecommand.proto";

/**
 * This is the gRPC definition of the CDDS TC Service for uplink of 
 * CLTUs or Telecommand frames.
 */
service TcServiceProvider {

    /**
     * Opens a bi-directional telecommand stream to send TC radiation request
     * carrying a CLTU or a TC frame.
     * The returned stream will receive the TC reports reporting on radiation, 
     * provider states uplink failures.
     * 
     * The service requires the following metadata when calling the service method:
     *      1) tc-endpoint-bin = JSON encoded TcServiceEndpoint using the binary marshaller
     *
     * The tc-endpoint-bin is authorized for the authenticated user. If not authorized,
     * the method call will fail.
     */ 
    rpc openTelecommandStream(stream TelecommandMessage) returns (stream TelecommandReport); 
}

/**
 * Allows the identification of a service endpoint in terms
 * of the parameters provided below.
 */
message TcServiceEndpoint {

    /**
     * The name of the service provider organization providing the TM service
     */
    optional string serviceProvider = 1;

    /**
     * The service user (spacecraft) for which TC shall be delivered
     */
    string serviceUser = 2;

    /**
     * The name of the terminal providing the TC service
     */
    optional string terminal = 3;

    /**
     * Indicates the use of the endpoint for uplink of CLTU,
     * or a TC VC when the TC User provides TC frames for radiation.
     */
    oneof type {
        bool    cltu = 4;       // encoded CLTU
        GvcId   gvcId = 5;      // TC Global VC ID: Spacecraft ID, Transfer Frame Version, VC ID
    }

    /**
     * An optional endpoint name to distinguish endpoints;
     * for instance for spacecrafts supporting multiple bands.
     */
    optional string endpointName = 6;

    /**
     * The CDDS service version of this service
     */
    uint32 serviceVersion = 7;
}